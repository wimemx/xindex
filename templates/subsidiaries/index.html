{% extends "base.html" %}
<!DOCTYPE html>
<html>
<head>
    <title>{% block title %}Subsidiarias{% endblock %}</title>
</head>
<body>
{% block mainContent %}
    <section class="vbox">
        <header class="header b-b">
            <p class="h4 animated bounceInDown">Subsidiarias</p>
        </header>
        <section class="panel padder padder-v animated fadeInRight">

            <div class="col-lg-12 h2">
                Mis Sucursales
            </div>
            <div class="col-lg-12 padder-v">
                <div class="row">
                    <div class="col-lg-3">
                        <a class="btn bg-success btn-modal-xindex"
                           href="/subsidiaries/add/"
                           data-toggle="ajaxModal"
                           style="width: 100%">
                            <i class="icon-plus"></i>
                            Crear nueva sucursal
                        </a>
                    </div>
                    <div class="col-lg-1"></div>
                    <div class="col-lg-3">
                        <div class="input-group search datagrid-search"
                             style="width: 100% !important;">
                            <input type="text"
                                   class="input-sm form-control"
                                   placeholder="Buscar">

                            <div class="input-group-btn">
                                <button class="btn btn-white btn-sm">
                                    <i class="icon-search"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-5">
                        <div class="row">
                            <div class="col-lg-1">
                                <label>Filtar:</label>
                            </div>
                            <div class="col-lg-5">
                                <select class="form-control">
                                    <option>Zona</option>
                                    <option>Tipo de sucursal</option>
                                </select>
                            </div>
                            <div class="col-lg-6">
                                <select class="form-control">
                                    <option>all-subsidiaries</option>
                                    <option>all-zones</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-12">
                <table class="table table-striped datagrid m-b-sm">
                    <thead>
                    <tr>
                        <th>Nombre</th>
                        <th>Tipo de sucursal</th>
                        <th>Zona</th>
                        <th>Ubicación</th>
                        <th>Acciones</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for eachSubsidiary in all_subsidiaries %}
                        <tr>
                        <td>
                            <a href="/subsidiaries/details/{{ eachSubsidiary.id }}">
                                {{ eachSubsidiary.name }}
                            </a>
                        </td>
                        <td>{{ eachSubsidiary.subsidiary_types.name }} Type</td>
                        <td>{{ eachSubsidiary.zone.name }}</td>
                        <td>{{ eachSubsidiary.state_id.name }}</td>
                        <td>
                            <a href="#"><i class="icon-edit"></i></a>|
                            <a href="/subsidiaries/remove/{{ eachSubsidiary.id }}" id="remove-subsidiary"><i class="icon-remove"></i></a>
                        </td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </section>
    </section>
{% endblock %}

{% block externalJs %}
    <!-- App -->
    <script src="/static/js/app.js"></script>
    <script src="/static/js/app.plugin.js"></script>
    <script src="/static/js/app.grids.data.js"></script>

    <!--Bootbox-->
    <script src="/static/js/bootbox/bootbox.min.js"></script>
    <!-- fuelux -->
    <script src="/static/js/fuelux/fuelux.js"></script>
    <script src="/static/js/libs/underscore-min.js"></script>
    <!-- datatables -->
    <script src="/static/js/datatables/jquery.dataTables.min.js"></script>
    <!-- Sparkline Chart -->
    <script src="/static/js/charts/sparkline/jquery.sparkline.min.js"></script>
    <!-- Easy Pie Chart -->
    <script src="/static/js/charts/easypiechart/jquery.easy-pie-chart.js"></script>

    <script src="/static/js/app.grids.xindex.js"></script>

<script>
    $(document).on('click', '#remove-subsidiary', function (e) {
        e.preventDefault();
        var href = $(this).attr('href');
        bootbox.dialog({
            message: "La sucursal tiene X unidades de sercio que quedarán " +
                    "inhabilitas si se realiza esta acción. " +
                    "¿Esta seguro que desea eliminar la sucursal NOMBRE? ",
            title: "Deshabilitar una sucursal",
            buttons: {
                success: {
                    label: "Cancelar",
                    className: "bg-danger btn-modal-xindex",
                    callback: function () {
                    }
                },
                main: {
                    label: "Aceptar",
                    className: "bg-success btn-modal-xindex",
                    callback: function () {
                        $.ajax({
                            type: 'GET',
                            url: href,
                            success: function (msg) {
                                if (msg == 'Si') {
                                    alert(msg);
                                    setTimeout(function () {
                                        window.location.reload(true);
                                    }, 0);
                                    return true;
                                }
                            },
                            error: function (msg) {
                            }

                        });
                    }
                }
            }
        });
    });
</script>
{% endblock %}
</body>
</html>